# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MopaqWhuW-IBe0pPGG6G-OphdtyXSxG7
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# åŠ è½½æ•°æ®
@st.cache
def load_data():
    # ä½¿ç”¨GitHubä¸Šçš„CSVæ–‡ä»¶é“¾æ¥æˆ–æœ¬åœ°æ–‡ä»¶è·¯å¾„
    url = "https://raw.githubusercontent.com/Mhu0824/Streamlit/0cf50d29b8420dec4063fac0a9641bd68a9b28f0/movies_dataset1.csv"
    return pd.read_csv(url, encoding='ISO-8859-1')

# æ•°æ®åŠ è½½
df = load_data()

# æ ‡é¢˜
st.title("ğŸ¬ Movie Data Dashboard")

# æ•°æ®æ¦‚è§ˆ
st.header("Overview")
st.write("Dataset Snapshot:")
st.dataframe(df.head())

# åŠŸèƒ½ 1: ç”µå½±ç±»å‹åˆ†å¸ƒ
st.header("Genre Distribution")

# åˆå¹¶ç”µå½±ç±»å‹åˆ—å¹¶å»æ‰ç©ºæ ¼
genres = pd.concat([
    df['genre_1'].str.strip(), 
    df['genre_2'].str.strip(), 
    df['genre_3'].str.strip(),
    df['genre_4'].str.strip(),
    df['genre_5'].str.strip()
]).dropna()

#1. è®¡ç®—ç±»å‹åˆ†å¸ƒ
genre_counts = genres.value_counts()

# è·å–å‰15ä¸ªç±»å‹åŠå…¶æ•°é‡
top_15_genres = genre_counts.head(15)

# å°†å…¶ä½™ç±»å‹åˆå¹¶ä¸º"Other"
other_count = genre_counts[15:].sum()

# åˆ›å»ºä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œç¡®ä¿ "Other" åœ¨ç¬¬åå…­ä½
top_15_genres_with_other = pd.concat(
    [top_15_genres, pd.Series({"Other": other_count})]
).iloc[:16]  # é™åˆ¶æœ€å¤š 16 é¡¹

# æ˜¾ç¤ºå‰15ä¸ªç±»å‹å’Œå®ƒä»¬çš„æ•°é‡
st.write("Top 15 Genres and Their Counts (with Other):")
st.write(top_15_genres_with_other)

# ä¸ºå›¾è¡¨é‡æ–°æ’åˆ—é¡ºåºï¼Œç¡®ä¿å‰15ä¸ªæŒ‰å¤§å°æ’åºï¼Œ"Other" åœ¨æœ€å
top_15_genres_sorted = pd.concat([
    top_15_genres.sort_values(ascending=False),  # å‰15é¡¹æŒ‰é™åºæ’åº
    pd.Series({"Other": other_count})           # "Other" æ”¾åœ¨æœ€å
])

# æ˜¾ç¤ºæŸ±çŠ¶å›¾
st.bar_chart(top_15_genres_sorted)

# åŠŸèƒ½ 2: ä¸åŒå›½å®¶ç”µå½±ç±»å‹æ’è¡Œ
#å¤„ç† country å’Œ genre åˆ—
# å°† country åˆ—æ‹†åˆ†æˆç‹¬ç«‹çš„å›½å®¶
df['country'] = df['country'].str.split(", ")
df_exploded = df.explode('country')  # å±•å¼€æˆå¤šè¡Œ

# Streamlit App
st.title("Top Genres by Country")

# ç”¨æˆ·é€‰æ‹©å›½å®¶
countries = df_exploded['country'].dropna().unique()
selected_country = st.selectbox("Select a Country:", sorted(countries))

# è·å–æ‰€é€‰å›½å®¶çš„ Top 10 Genres
if selected_country:
    country_data = df_exploded[df_exploded['country'] == selected_country]
    top_genres = country_data['genre'].value_counts().head(10)

    # æ˜¾ç¤ºå‰ 10 ç±»å‹åŠå…¶æ•°é‡
    st.write(f"Top 10 Genres in {selected_country}:")
    st.write(top_genres)

    # ç»˜åˆ¶æŸ±çŠ¶å›¾
    fig, ax = plt.subplots(figsize=(8, 6))
    sns.barplot(x=top_genres.values, y=top_genres.index, ax=ax, palette="viridis")
    ax.set_title(f"Top 10 Genres in {selected_country}")
    ax.set_xlabel("Count")
    ax.set_ylabel("Genre")
    st.pyplot(fig)
