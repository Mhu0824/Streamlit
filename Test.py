# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MopaqWhuW-IBe0pPGG6G-OphdtyXSxG7
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# åŠ è½½æ•°æ®
@st.cache
def load_data():
    # ä½¿ç”¨GitHubä¸Šçš„CSVæ–‡ä»¶é“¾æ¥æˆ–æœ¬åœ°æ–‡ä»¶è·¯å¾„
    url = "https://raw.githubusercontent.com/Mhu0824/Streamlit/0cf50d29b8420dec4063fac0a9641bd68a9b28f0/movies_dataset1.csv"
    return pd.read_csv(url, encoding='ISO-8859-1')

# æ•°æ®åŠ è½½
df = load_data()

# æ ‡é¢˜
st.title("ğŸ¬ Movie Data Dashboard")

# æ•°æ®æ¦‚è§ˆ
st.header("Overview")
st.write("Dataset Snapshot:")
st.dataframe(df.head())

# åŠŸèƒ½ 1: ç”µå½±ç±»å‹åˆ†å¸ƒ
st.header("Genre Distribution")

# å¤„ç†ç”µå½±ç±»å‹æ•°æ®
genres = pd.concat([
    df['genre_1'].str.strip(), 
    df['genre_2'].str.strip(), 
    df['genre_3'].str.strip(),
    df['genre_4'].str.strip(),
    df['genre_5'].str.strip()
]).dropna()

# è®¡ç®—æ‰€æœ‰ç±»å‹çš„åˆ†å¸ƒ
genre_counts = genres.value_counts()

# åœ¨ Streamlit ä¸­æ˜¾ç¤ºæ‰€æœ‰ç±»å‹åŠå…¶æ•°é‡
st.header("All Genres and Their Counts")
st.write(genre_counts)

# è·å–å‰ 15 ä¸ªç±»å‹åŠå…¶æ•°é‡
top_15_genres = genre_counts.head(15)

# å°†å…¶ä½™ç±»å‹åˆå¹¶ä¸º "Other"
other_count = genre_counts[15:].sum()

# åˆ›å»ºä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œå°† "Other" ç›´æ¥æ·»åŠ åˆ°å‰ 15 ä¸ªç±»å‹ä¸­
top_15_genres_with_other = pd.concat(
    [top_15_genres, pd.Series({"Other": other_count})]
)

# æ˜¾ç¤ºæŸ±çŠ¶å›¾
st.header("Top 15 Genres and 'Other'")
st.bar_chart(top_15_genres_with_other)

#2.ä¸åŒå›½å®¶ç”µå½±ç±»å‹
# æ‹†åˆ† `country` åˆ—ï¼Œç¡®ä¿æ¯ä¸ªå›½å®¶å•ç‹¬ç»Ÿè®¡
df['country'] = df['country'].str.split(", ")
df_exploded = df.explode('country')  # å°†æ¯ä¸ªå›½å®¶å±•å¼€æˆç‹¬ç«‹çš„è¡Œ

# ç¡®ä¿åªç»Ÿè®¡ `genre_1` æ•°æ®ï¼Œå»æ‰ç©ºå€¼
df_exploded = df_exploded[['country', 'genre_1']].dropna()
df_exploded['genre_1'] = df_exploded['genre_1'].str.strip()  # å»æ‰ç©ºæ ¼

# æŒ‰å›½å®¶å’Œç±»å‹åˆ†ç»„ç»Ÿè®¡
country_genre_counts = df_exploded.groupby(['country', 'genre_1']).size().reset_index(name='count')

# æ·»åŠ  Streamlit ç•Œé¢è®©ç”¨æˆ·é€‰æ‹©å›½å®¶
st.title("Top Genres by Country")
selected_country = st.selectbox("Select a country to view its top genres:", sorted(country_genre_counts['country'].unique()))

# è·å–é€‰å®šå›½å®¶çš„å‰ 10 ä¸ªç±»å‹
if selected_country:
    top_genres_for_country = country_genre_counts[country_genre_counts['country'] == selected_country].nlargest(10, 'count')

    # æ˜¾ç¤ºç»“æœ
    st.write(f"Top 10 Genres in {selected_country}:")
    st.write(top_genres_for_country)

    # ç»˜åˆ¶æŸ±çŠ¶å›¾
    st.bar_chart(data=top_genres_for_country.set_index('genre_1')['count'])
